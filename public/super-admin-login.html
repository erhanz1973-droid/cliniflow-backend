<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clinifly Super Admin ‚Äì Login</title>
  <style>
    :root { 
      --bg:#0f172a; 
      --card:#020617; 
      --b:#1f2937; 
      --p:#8b5cf6; 
      --g:#16a34a; 
      --r:#dc2626;
      --warn:#f59e0b;
      --muted:#a7b2c8;
    }
    body{ 
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; 
      margin:0; 
      background:var(--bg); 
      color:#e6eaf2; 
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    .container{
      max-width:500px;
      width:100%;
    }
    .header{
      text-align:center;
      margin-bottom:32px;
    }
    .header h1{
      font-size:32px;
      margin:0 0 8px;
      font-weight:900;
      color:#e6eaf2;
    }
    .subtitle{
      color:var(--muted);
      font-size:16px;
      margin:0;
    }
    .form-container{
      background:var(--card);
      border:1px solid var(--b);
      border-radius:16px;
      padding:32px;
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
    }
    .form-group{
      margin-bottom:20px;
    }
    label{
      display:block;
      font-size:14px;
      font-weight:600;
      color:#e6eaf2;
      margin-bottom:8px;
    }
    .required{
      color:var(--r);
    }
    input{
      width:100%;
      padding:12px 16px;
      border:1px solid var(--b);
      border-radius:8px;
      background:#1f2937;
      color:#e6eaf2;
      font-size:15px;
      box-sizing:border-box;
      transition:border-color 0.2s;
    }
    input:focus{
      outline:none;
      border-color:var(--p);
    }
    input::placeholder{
      color:#6b7280;
    }
    .help-text{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }
    .btn{
      width:100%;
      padding:14px;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
      transition:all 0.2s;
    }
    .btn-primary{
      background:var(--p);
      color:#fff;
    }
    .btn-primary:hover{
      background:#7c3aed;
    }
    .btn-primary:disabled{
      background:#6b7280;
      cursor:not-allowed;
    }
    #alert-container{
      margin-bottom:20px;
    }
    .alert{
      padding:12px 16px;
      border-radius:8px;
      margin-bottom:12px;
      font-size:14px;
      font-weight:600;
    }
    .alert-success{
      background:#065f46;
      border:1px solid var(--g);
      color:#86efac;
    }
    .alert-error{
      background:#7f1d1d;
      border:1px solid var(--r);
      color:#fca5a5;
    }
    .warning-badge{
      display:inline-block;
      background:#7f1d1d;
      border:1px solid var(--r);
      color:#fca5a5;
      padding:4px 8px;
      border-radius:6px;
      font-size:12px;
      font-weight:600;
      margin-left:8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîê Super Admin Login</h1>
      <p class="subtitle">Sistem y√∂neticisi giri≈üi</p>
    </div>

    <div id="alert-container"></div>

    <div class="form-container">
      <form id="login-form">
        <div class="form-group">
          <label>
            Email <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="superadmin@clinifly.net"
            required
            autofocus
          />
          <div class="help-text">Super admin email adresi</div>
        </div>

        <div class="form-group">
          <label>
            Password <span class="required">*</span>
          </label>
          <input
            type="password"
            id="password"
            name="password"
            autocomplete="off"
            required
          />
          <div class="help-text">Super admin ≈üifresi</div>
        </div>

        <button type="submit" class="btn btn-primary" id="submit-btn">
          Login
        </button>
      </form>
    </div>
  </div>

<script>
  const API = window.location.origin;
  
  function setMsg(msg, type = "ok") {
    const container = document.getElementById("alert-container");
    container.innerHTML = `<div class="alert alert-${type}">${msg}</div>`;
    setTimeout(() => {
      container.innerHTML = "";
    }, 5000);
  }

  document.getElementById("login-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const submitBtn = document.getElementById("submit-btn");
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    
    if (!email) {
      setMsg("Email gereklidir.", "error");
      return;
    }
    
    if (!password) {
      setMsg("≈ûifre gereklidir.", "error");
      return;
    }
    
    submitBtn.disabled = true;
    submitBtn.textContent = "Giri≈ü yapƒ±lƒ±yor...";
    
    try {
      const res = await fetch(`${API}/api/super-admin/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });
      
      const json = await res.json();
      
      if (!res.ok) {
        let errorMsg = json.message || json.error || "Giri≈ü ba≈üarƒ±sƒ±z";
        if (json.error === "invalid_credentials") {
          errorMsg = "Ge√ßersiz email veya ≈üifre";
        } else if (json.error === "missing_credentials") {
          errorMsg = "Email ve ≈üifre gereklidir";
        } else if (json.error === "configuration_error") {
          errorMsg = "Super admin yapƒ±landƒ±rƒ±lmamƒ±≈ü";
        }
        setMsg(errorMsg, "error");
        submitBtn.disabled = false;
        submitBtn.textContent = "Login";
        return;
      }
      
      if (json.ok && json.token) {
        localStorage.setItem("super_admin_token", json.token);
        setMsg("Giri≈ü ba≈üarƒ±lƒ±! Y√∂nlendiriliyorsunuz...", "success");
        
        setTimeout(() => {
          window.location.href = "/super-admin.html";
        }, 1000);
      } else {
        setMsg("Giri≈ü ba≈üarƒ±sƒ±z", "error");
        submitBtn.disabled = false;
        submitBtn.textContent = "Login";
      }
    } catch (error) {
      console.error("Login error:", error);
      setMsg("Baƒülantƒ± hatasƒ±: " + (error.message || "Bilinmeyen hata"), "error");
      submitBtn.disabled = false;
      submitBtn.textContent = "Login";
    }
  });

  // Check if already logged in
  const existingToken = localStorage.getItem("super_admin_token");
  if (existingToken) {
    // Verify token by calling /api/super-admin/me
    fetch(`${API}/api/super-admin/me`, {
      headers: { "Authorization": `Bearer ${existingToken}` }
    })
    .then(res => {
      if (res.ok) {
        // Token is valid, redirect to dashboard
        window.location.href = "/super-admin.html";
      } else {
        // Token is invalid, clear it
        localStorage.removeItem("super_admin_token");
      }
    })
    .catch(() => {
      // Network error, clear token
      localStorage.removeItem("super_admin_token");
    });
  }
</script>
</body>
</html>
